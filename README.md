# Сбор и Анализ Метаданных Изображений с Помощью Python

## Описание

Этот Python-скрипт предназначен для обработки фотографий в формате JPG/JPEG, сделанных с дрона DJI с камерой Zenmuse P1. Скрипт рекурсивно обходит указанный каталог, извлекает EXIF-данные из изображений, рассчитывает дополнительные параметры и сохраняет результаты в форматах CSV и Excel. Также скрипт обнаруживает и предупреждает о дубликатах изображений, основываясь на их хеш-суммах.

### Основные Возможности:

- **Рекурсивный Поиск Изображений:** Обходит все вложенные папки и ищет изображения.
- **Извлечение EXIF-данных:** Получает информацию о GPS-координатах, времени съемки, высоте, размерах изображения и фокусном расстоянии.
- **Расчет Дополнительных Параметров:**
  - Угол обзора камеры (горизонтальный и вертикальный).
  - Размеры захваченной области на земле (в метрах).
  - Разрешение изображения (см/пиксель).
  - Расстояние до предыдущего снимка (в метрах).
  - Типовой линейный размер объекта (пикселей) при известном размере объекта (1 метр).
- **Обнаружение Дубликатов:** Выявляет идентичные изображения по их MD5-хешам и предупреждает пользователя, пропуская дубликаты при записи данных.
- **Сохранение Результатов:** Экспорт данных в два формата:
  - CSV (`output.csv`) для простого анализа.
  - Excel (`output.xlsx`) для удобного просмотра и дальнейшей обработки в Microsoft Excel.

## Требования

- **Python:** Версия 3.6 и выше.
- **Библиотеки Python:**
  - `exifread`
  - `pandas`
  - `openpyxl`
  - `hashlib` (стандартная библиотека)
  - `math` (стандартная библиотека)
  - `csv` (стандартная библиотека)
  - `os` (стандартная библиотека)
  - `datetime` (стандартная библиотека)

## Настройка Скрипта

Откройте файл скрипта (`script_name.py`) в текстовом редакторе и настройте следующие параметры:

```python
# Настраиваемые параметры
ROOT_DIR = r'C:\Users\mkolp\OneDrive\Документы\Датасет'  # Корневой каталог с изображениями
OUTPUT_CSV = 'output.csv'  # Имя выходного CSV файла
OUTPUT_EXCEL = 'output.xlsx'  # Имя выходного Excel файла
SENSOR_WIDTH_MM = 36.0  # Ширина сенсора в мм (для камеры Zenmuse P1)
SENSOR_HEIGHT_MM = 24.0  # Высота сенсора в мм (для камеры Zenmuse P1)
```

### Пояснения к Параметрам:

- **ROOT_DIR:** Полный путь к корневой папке, содержащей фотографии. Скрипт будет рекурсивно обходить все вложенные папки внутри этого каталога.
  
- **OUTPUT_CSV:** Имя файла CSV, куда будут сохранены результаты обработки.
  
- **OUTPUT_EXCEL:** Имя файла Excel, куда будут сохранены результаты обработки.
  
- **SENSOR_WIDTH_MM и SENSOR_HEIGHT_MM:** Размеры сенсора камеры в миллиметрах. По умолчанию установлены для камеры Zenmuse P1 (36mm x 24mm).

## Использование

1. **Запуск Скрипта:**

   Перейдите в каталог, где находится скрипт, и выполните команду:

   ```bash
   python script_name.py
   ```

   **Примечание:**
   Замените `script_name.py` на фактическое имя вашего скрипта.

2. **Процесс Выполнения:**

   Скрипт выведет в консоль сообщения, информируя о текущем этапе выполнения:

   - Сканирование каталогов.
   - Количество найденных изображений.
   - Обработка каждого файла с указанием прогресса.
   - Обнаружение дубликатов.
   - Сортировка данных.
   - Вычисление дополнительных параметров.
   - Запись данных в CSV и Excel файлы.
   - Завершение обработки.

3. **Результаты:**

   После завершения работы скрипта в указанной директории появятся два файла:

   - `output.csv` — содержит собранные данные в формате CSV.
   - `output.xlsx` — содержит те же данные в формате Excel для удобного просмотра и дальнейшей обработки.

## Обнаружение Дубликатов

- **Механизм Обнаружения:**

  Скрипт вычисляет MD5-хеш каждого файла изображения. Если хеш уже существует в наборе хешей (`hash_set`), файл считается дубликатом, и его обработка пропускается. Пользователь получает предупреждение о каждом обнаруженном дубликате.

- **Предупреждения:**

  При обнаружении дубликата в консоли выводится сообщение:

  ```
  Предупреждение: Обнаружен дубликат файла <имя_файла>. Запись будет пропущена.
  ```

- **Общее Сообщение:**

  Если были обнаружены дубликаты, после обработки всех файлов выводится:

  ```
  Обнаружены дубликаты файлов. Проверьте предупреждения выше.
  ```

## Пример Данных

Ниже приведен пример извлеченных EXIF-данных из изображения:

```
ImageDescription	default
Make	DJI
Model	ZenmuseP1
Orientation	1
XResolution	72
YResolution	72
ResolutionUnit	inches
Software	07.00.01.10
ModifyDate	2024:09:07 11:44:38
YCbCrPositioning	Co-sited
ExposureTime	1/1000
FNumber	5.6
ExposureProgram	Program AE
ISO	800
SensitivityType	Recommended Exposure Index
ExifVersion	0230
DateTimeOriginal	2024:09:07 11:44:38
CreateDate	2024:09:07 11:44:38
ComponentsConfiguration	Y, Cb, Cr, -
ShutterSpeedValue	1/1000
ApertureValue	5.6
ExposureCompensation	-0.3
MaxApertureValue	2.8
MeteringMode	Center-weighted average
LightSource	Daylight
Flash	No Flash
FocalLength	35.0 mm
FlashpixVersion	0100
ColorSpace	sRGB
ExifImageWidth	8192
ExifImageHeight	5460
InteropIndex	R98 - DCF basic file (sRGB)
InteropVersion	0100
FileSource	Digital Camera
SceneType	Directly photographed
ExposureMode	Auto
WhiteBalance	Manual
DigitalZoomRatio	1
FocalLengthIn35mmFormat	35 mm
SceneCaptureType	Standard
GainControl	None
Contrast	High
Saturation	Normal
Sharpness	Hard
DeviceSettingDescription	(Binary data 4 bytes, use -b option to extract)
SerialNumber	3XMDJC4001L681
LensInfo	35mm f/2.8
LensSerialNumber	01KY101G057P
GPSVersionID	2.3.0.0
GPSLatitudeRef	North
GPSLatitude	56.0924840833333
GPSLongitudeRef	East
GPSLongitude	36.0901628333333
GPSAltitudeRef	Above Sea Level
GPSAltitude	333.252
GPSStatus	Measurement Active
GPSMapDatum	WGS-84
XPComment	0.9.142
XPKeywords	single
Compression	JPEG
ThumbnailOffset	25006
ThumbnailLength	12843
ThumbnailImage	(Binary data 12843 bytes, use -b option to extract)
```

## Примечания

- **Обработка Исключений:**

  Скрипт продолжает работу даже при возникновении ошибок с отдельными файлами, выводя соответствующие сообщения в консоль.

- **Формат Времени Съемки:**

  Скрипт пытается распознать различные форматы времени съемки. Если формат отличается от ожидаемого, время съемки будет отмечено как `None`.
